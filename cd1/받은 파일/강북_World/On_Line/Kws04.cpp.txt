#include <fstream.h>
#include <string.h>
#include <ctype.h>

void input( void );
void process( void );
void output( void );
void bck_tr( int x );

int ta[ 3 ][ 3 ];
int arr[ 100 ][ 4 ];
int res[ 100 ][ 4 ];
int min = 100;
int kk = 1;

int main( void )
{
	while( kk )
	{
		kk = 0;
		input();
		process();
		output();
	}

	return 0;
}

void input( void )
{
	char expr[ 1000 ];
	char str[ 100 ];
	int l1, l2;
	int l, k = 0;

aa:
	for( l1 = 0; l1 < 3; l1++ )
	{
		for( l2 = 0; l2 < 3; l2++ )
		{
			ta[ l1 ][ l2 ] = 0;
		}
	}
	cout << "Input expression : ";
	cin.getline( expr, 1000, '\n' );
	l = strlen( expr );
	for( l1 = 0; l1 < l; l1++ )
	{
		if( expr[ l1 ] == ' ' )
		{
			for( l2 = l1; l2 < l; l2++ )
			{
				expr[ l2 ] = expr[ l2 + 1 ];
			}
			l1--; l--;
		}
		else if( expr[ l1 ] != 'a' && expr[ l1 ] != 'b' && expr[ l1 ] != '1' && expr[ l1 ] != '2' && expr[ l1 ] != '3' && expr[ l1 ] != '+' ) goto aa;
	}
	for( l1 = 0; l1 < l; l1++ )
	{
		if( expr[ l1 ] == '+' )
		{
			if( k != 4 ) goto aa;
			if( str[ 0 ] != 'a' || str[ 2 ] != 'b' ) goto aa;
			if( str[ 1 ] > '3' || str[ 1 ] < '1' || str[ 3 ] > '3' || str[ 3 ] < '1' ) goto aa;
			if( ta[ str[ 1 ] - '1' ][ str[ 3 ] - '1' ] == 1 ) goto aa;
			ta[ str[ 1 ] - '1' ][ str[ 3 ] - '1' ] = 1;
			k = 0;
		}
		else
		{
			str[ k++ ] = expr[ l1 ];
		}
	}
	if( k != 4 ) goto aa;
	if( str[ 0 ] != 'a' || str[ 2 ] != 'b' ) goto aa;
	if( str[ 1 ] > '3' || str[ 1 ] < '1' || str[ 3 ] > '3' || str[ 3 ] < '1' ) goto aa;
	if( ta[ str[ 1 ] - '1' ][ str[ 3 ] - '1' ] == 1 ) goto aa;
	ta[ str[ 1 ] - '1' ][ str[ 3 ] - '1' ] = 1;
}

void process( void )
{
	bck_tr( 0 );
}

void output( void )
{
	char str[ 100 ];
	int l1;
	int l, tmp1;

	cout << "Result : ";
	cout << 'a';
	if( res[ 0 ][ 0 ] == res[ 0 ][ 2 ] ) cout << res[ 0 ][ 0 ] + 1;
	else
	{
		cout << '<' << res[ 0 ][ 0 ] + 1 << ',' << res[ 0 ][ 2 ] + 1 << '>';
	}
	cout << 'b';
	if( res[ 0 ][ 1 ] == res[ 0 ][ 3 ] ) cout << res[ 0 ][ 1 ] + 1;
	else
	{
		cout << '<' << res[ 0 ][ 1 ] + 1 << ',' << res[ 0 ][ 3 ] + 1 << '>';
	}
	for( l1 = 1; l1 < min; l1++ )
	{
		cout << "+a";
		if( res[ l1 ][ 0 ] == res[ l1 ][ 2 ] ) cout << res[ l1 ][ 0 ] + 1;
		else
		{
			cout << '<' << res[ l1 ][ 0 ] + 1 << ',' << res[ l1 ][ 2 ] + 1 << '>';
		}
		cout << 'b';
		if( res[ l1 ][ 1 ] == res[ l1 ][ 3 ] ) cout << res[ l1 ][ 1 ] + 1;
		else
		{
			cout << '<' << res[ l1 ][ 1 ] + 1 << ',' << res[ l1 ][ 3 ] + 1 << '>';
		}
	}
	cout << endl;
bb:
	cout << "Retry? "; cin.getline( str, 100, '\n' );
	l = strlen( str ); tmp1 = 0;
	for( l1 = 0; l1 < l; l1++ )
	{
		if( str[ l1 ] != ' ' ) tmp1++;
	}
	if( tmp1 != 1 ) goto bb;
	for( l1 = 0; l1 < l; l1++ )
	{
		if( str[ l1 ] != ' ' )
		{
			if( tolower( str[ l1 ] ) == 'y' ) kk = 1;
			else if( tolower( str[ l1 ] ) == 'n' ) kk = 0;
			else goto bb;
		}
	}
}

void bck_tr( int x )
{
	if( x >= min ) return;
	int l1, l2, l3, l4;
	int sw = 0;

	for( l1 = 0; l1 < 3; l1++ )
	{
		for( l2 = 0; l2 < 3; l2++ )
		{
			if( ta[ l1 ][ l2 ] == 1 )
			{
				sw = 1;
				arr[ x ][ 0 ] = l1;
				for( l3 = l1; l3 < 3; l3++ )
				{
					if( ta[ l3 ][ l2 ] == 0 ) break;
				}
				arr[ x ][ 2 ] = l3 - 1; arr[ x ][ 1 ] = l2;
				for( l3 = l2; l3 < 3; l3++ )
				{
					for( l4 = arr[ x ][ 0 ]; l4 <= arr[ x ][ 2 ]; l4++ )
					{
						if( ta[ l4 ][ l3 ] == 0 ) break;
					}
					if( l4 != arr[ x ][ 2 ] + 1 ) break;
				}
				arr[ x ][ 3 ] = l3 - 1;
				for( l3 = arr[ x ][ 0 ]; l3 <= arr[ x ][ 2 ]; l3++ )
				{
					for( l4 = arr[ x ][ 1 ]; l4 <= arr[ x ][ 3 ]; l4++ )
					{
						ta[ l3 ][ l4 ] = 0;
					}
				}
				bck_tr( x + 1 );
				for( l3 = arr[ x ][ 0 ]; l3 <= arr[ x ][ 2 ]; l3++ )
				{
					for( l4 = arr[ x ][ 1 ]; l4 <= arr[ x ][ 3 ]; l4++ )
					{
						ta[ l3 ][ l4 ] = 1;
					}
				}
			}
		}
	}
	if( sw == 0 )
	{
		min = x;
		for( l1 = 0; l1 < min; l1++ )
		{
			res[ l1 ][ 0 ] = arr[ l1 ][ 0 ];
			res[ l1 ][ 1 ] = arr[ l1 ][ 1 ];
			res[ l1 ][ 2 ] = arr[ l1 ][ 2 ];
			res[ l1 ][ 3 ] = arr[ l1 ][ 3 ];
		}
	}
}